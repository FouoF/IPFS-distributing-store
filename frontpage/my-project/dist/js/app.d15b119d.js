(function(){"use strict";var e={1873:function(e,n,t){var a=t(5130),o=t(6768);const l={id:"app"};function d(e,n,t,a,d,i){const r=(0,o.g2)("el-menu-item"),s=(0,o.g2)("el-menu"),u=(0,o.g2)("el-header"),c=(0,o.g2)("router-view"),p=(0,o.g2)("el-main"),m=(0,o.g2)("el-container");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(s,{mode:"horizontal","default-active":e.activeMenu},{default:(0,o.k6)((()=>[(0,o.bF)(r,{index:"1",onClick:n[0]||(n[0]=n=>e.navigateTo("endpoint"))},{default:(0,o.k6)((()=>n[3]||(n[3]=[(0,o.eW)("Endpoint")]))),_:1}),(0,o.bF)(r,{index:"2",onClick:n[1]||(n[1]=n=>e.navigateTo("node"))},{default:(0,o.k6)((()=>n[4]||(n[4]=[(0,o.eW)("Node")]))),_:1}),(0,o.bF)(r,{index:"3",onClick:n[2]||(n[2]=n=>e.navigateTo("query"))},{default:(0,o.k6)((()=>n[5]||(n[5]=[(0,o.eW)("Query")]))),_:1})])),_:1},8,["default-active"])])),_:1}),(0,o.bF)(p,null,{default:(0,o.k6)((()=>[(0,o.bF)(c)])),_:1})])),_:1})])}t(4114);var i=t(1387),r=(0,o.pM)({name:"App",setup(){const e=(0,i.rd)(),n="1",t=n=>{e.push(`/${n}`)};return{activeMenu:n,navigateTo:t}}}),s=t(1241);const u=(0,s.A)(r,[["render",d]]);var c=u,p=t(809);t(4188);const m={class:"header-container"};function f(e,n,t,a,l,d){const i=(0,o.g2)("el-button"),r=(0,o.g2)("el-table-column"),s=(0,o.g2)("el-table"),u=(0,o.g2)("el-input"),c=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-form"),f=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",m,[n[9]||(n[9]=(0,o.Lk)("h1",null,"数据源视图",-1)),(0,o.bF)(i,{type:"primary",onClick:d.openAddEndpointDialog,class:"add-endpoint-btn"},{default:(0,o.k6)((()=>n[8]||(n[8]=[(0,o.eW)("接入数据源")]))),_:1},8,["onClick"])]),(0,o.bF)(s,{data:l.endpoints,style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(r,{prop:"id",label:"编号"}),(0,o.bF)(r,{prop:"description",label:"描述"}),(0,o.bF)(r,{prop:"addr",label:"地址"}),(0,o.bF)(r,{label:"Actions"},{default:(0,o.k6)((({row:e})=>[(0,o.bF)(i,{size:"small",onClick:n=>d.removeEndpoint(e)},{default:(0,o.k6)((()=>n[10]||(n[10]=[(0,o.eW)("Delete")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,o.bF)(f,{title:"添加数据源",modelValue:l.dialogVisible,"onUpdate:modelValue":n[7]||(n[7]=e=>l.dialogVisible=e),width:"400px",onClose:d.resetForm},{footer:(0,o.k6)((()=>[(0,o.bF)(i,{onClick:n[6]||(n[6]=e=>l.dialogVisible=!1)},{default:(0,o.k6)((()=>n[11]||(n[11]=[(0,o.eW)("Cancel")]))),_:1}),(0,o.bF)(i,{type:"primary",onClick:d.addNewEndpoint},{default:(0,o.k6)((()=>n[12]||(n[12]=[(0,o.eW)("Add")]))),_:1},8,["onClick"])])),default:(0,o.k6)((()=>[(0,o.bF)(p,{model:l.newEndpoint,ref:"form"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{label:"编号",rules:[{required:!0,message:"Please input ID",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newEndpoint.id,"onUpdate:modelValue":n[0]||(n[0]=e=>l.newEndpoint.id=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"描述",rules:[{required:!0,message:"Please input description",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newEndpoint.description,"onUpdate:modelValue":n[1]||(n[1]=e=>l.newEndpoint.description=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"地址",rules:[{required:!0,message:"Please input address",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newEndpoint.addr,"onUpdate:modelValue":n[2]||(n[2]=e=>l.newEndpoint.addr=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"版块",rules:[{required:!0,message:"Please input address",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newEndpoint.index.name,"onUpdate:modelValue":n[3]||(n[3]=e=>l.newEndpoint.index.name=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"一级索引",rules:[{required:!0,message:"Please input address",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newEndpoint.index.L1,"onUpdate:modelValue":n[4]||(n[4]=e=>l.newEndpoint.index.L1=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"二级索引",rules:[{required:!0,message:"Please input address",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newEndpoint.index.L2,"onUpdate:modelValue":n[5]||(n[5]=e=>l.newEndpoint.index.L2=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","onClose"])])}t(4603),t(7566),t(8721);var b=t(4373);const g=b.A.create({baseURL:"/admin/",timeout:1e4,headers:{"Content-Type":"application/json"}}),h=()=>g.get("/node/list"),v=e=>g.post("/node/add",e),w=e=>g.post("/node/remove",e),k=()=>g.get("/endpoint/list"),F=e=>g.post("/endpoint/add",e),y=e=>g.post("/endpoint/remove",e),V=e=>{const n=new URLSearchParams;for(const t in e.index)e.index[t]&&n.append(`index.${t}`,e.index[t]);return g.get("/index/list",{params:n})},_=["http://ipfs.default.svc.cluster.local:5001"],C=async()=>{for(const n of _)try{return await b.A.post(`${n}/api/v0/version`,{timeout:2e3}),b.A.create({baseURL:n,timeout:15e3,responseType:"arraybuffer"})}catch(e){console.warn(`Gateway ${n} unavailable, trying next...`)}throw new Error("All IPFS gateways are down")},E=async(e,n,t)=>{const a=await C();try{const o=await a.post(`/api/v0/cat?arg=${e}`,{onDownloadProgress:e=>{if(t&&e.total){const n=Math.round(100*e.loaded/e.total);t(n)}}}),l=n||`ipfs_${e.slice(0,8)}`,d=new Blob([o.data]),i=window.URL.createObjectURL(d),r=document.createElement("a");return r.href=i,r.download=l,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r),!0}catch(o){return console.error("IPFS下载失败:",o),!1}},x=async e=>{try{const n=await C(),{data:t}=await n.post("/api/v0/files/stat",null,{params:{arg:`/ipfs/${e}`,format:"json",withLocal:!1}});return{size:t.cumulsize||0,type:t.type}}catch(n){return console.error("获取元数据失败:",n),{size:"unknown",type:"unknown"}}};var L={name:"EndpointView",data(){return{endpoints:[],dialogVisible:!1,newEndpoint:{id:"",description:"",address:"",index:{name:"",L1:"",L2:"",leafname:""}}}},created(){this.fetchEndpoints()},methods:{async fetchEndpoints(){try{const e=await k();this.endpoints=e.data.endpoint}catch(e){this.$message.error("Failed to load endpoints")}},openAddEndpointDialog(){this.dialogVisible=!0},async addNewEndpoint(){try{const e=await F(this.newEndpoint);e?(this.dialogVisible=!1,this.resetForm(),this.fetchEndpoints()):this.$message.error("Failed to add endpoint")}catch(e){this.$message.error("Failed to add endpoint")}},async removeEndpoint(e){try{await y(e.index),this.fetchEndpoints()}catch(n){this.$message.error("Failed to remove endpoint")}},resetForm(){this.newEndpoint={id:"",description:"",address:"",index:{name:"",L1:"",L2:"",leafname:""}}}}};const N=(0,s.A)(L,[["render",f],["__scopeId","data-v-768eef94"]]);var O=N;const A={class:"header-container"};function U(e,n,t,a,l,d){const i=(0,o.g2)("el-button"),r=(0,o.g2)("el-table-column"),s=(0,o.g2)("el-table"),u=(0,o.g2)("el-input"),c=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-form"),m=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",A,[n[6]||(n[6]=(0,o.Lk)("h1",null,"节点管理",-1)),(0,o.bF)(i,{type:"primary",onClick:d.openAddNodeDialog},{default:(0,o.k6)((()=>n[5]||(n[5]=[(0,o.eW)("接入节点")]))),_:1},8,["onClick"])]),(0,o.bF)(s,{data:l.nodes,style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(r,{prop:"id",label:"编号"}),(0,o.bF)(r,{prop:"name",label:"名称"}),(0,o.bF)(r,{prop:"status",label:"状态"}),(0,o.bF)(r,{prop:"addr",label:"地址"}),(0,o.bF)(r,{label:"Actions"},{default:(0,o.k6)((({row:e})=>[(0,o.bF)(i,{size:"small",onClick:n=>d.removeNode(e)},{default:(0,o.k6)((()=>n[7]||(n[7]=[(0,o.eW)("Delete")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,o.bF)(m,{title:"Add New Node",modelValue:l.dialogVisible,"onUpdate:modelValue":n[4]||(n[4]=e=>l.dialogVisible=e),width:"400px",onClose:d.resetForm},{footer:(0,o.k6)((()=>[(0,o.bF)(i,{onClick:n[3]||(n[3]=e=>l.dialogVisible=!1)},{default:(0,o.k6)((()=>n[8]||(n[8]=[(0,o.eW)("Cancel")]))),_:1}),(0,o.bF)(i,{type:"primary",onClick:d.addNewNode},{default:(0,o.k6)((()=>n[9]||(n[9]=[(0,o.eW)("Add")]))),_:1},8,["onClick"])])),default:(0,o.k6)((()=>[(0,o.bF)(p,{model:l.newNode,ref:"form"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{label:"ID",rules:[{required:!0,message:"Please input ID",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newNode.node.id,"onUpdate:modelValue":n[0]||(n[0]=e=>l.newNode.node.id=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"Name",rules:[{required:!0,message:"Please input name",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newNode.node.name,"onUpdate:modelValue":n[1]||(n[1]=e=>l.newNode.node.name=e)},null,8,["modelValue"])])),_:1}),(0,o.bF)(c,{label:"Address",rules:[{required:!0,message:"Please input address",trigger:"blur"}]},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:l.newNode.node.addr,"onUpdate:modelValue":n[2]||(n[2]=e=>l.newNode.node.addr=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","onClose"])])}var $={name:"NodeView",data(){return{nodes:[],dialogVisible:!1,newNode:{node:{id:"",name:"",addr:"",status:""}}}},created(){this.fetchNodes()},methods:{async fetchNodes(){try{const e=await h();this.nodes=e.data.node}catch(e){this.$message.error("Failed to load nodes")}},openAddNodeDialog(){this.dialogVisible=!0},async addNewNode(){try{await v(this.newNode),this.dialogVisible=!1,this.resetForm(),this.fetchNodes()}catch(e){this.$message.error("Failed to add node")}},async removeNode(e){try{await w(e),this.fetchNodes()}catch(n){this.$message.error("Failed to remove node")}},resetForm(){this.newNode={node:{id:"",name:"",addr:""}}}}};const P=(0,s.A)($,[["render",U],["__scopeId","data-v-09dec262"]]);var R=P;function W(e,n,t,a,l,d){const i=(0,o.g2)("el-option"),r=(0,o.g2)("el-select"),s=(0,o.g2)("el-col"),u=(0,o.g2)("el-row"),c=(0,o.g2)("el-table-column"),p=(0,o.g2)("el-button"),m=(0,o.g2)("el-table");return(0,o.uX)(),(0,o.CE)("div",null,[n[4]||(n[4]=(0,o.Lk)("div",{class:"header-container"},[(0,o.Lk)("h1",null,"数据查询")],-1)),(0,o.bF)(u,{gutter:20},{default:(0,o.k6)((()=>[(0,o.bF)(s,{span:8},{default:(0,o.k6)((()=>[(0,o.bF)(r,{modelValue:a.selectedOption1,"onUpdate:modelValue":n[0]||(n[0]=e=>a.selectedOption1=e),placeholder:"请选择数据板块",onChange:e.fetchOptions2},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.options1,(e=>((0,o.uX)(),(0,o.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,o.bF)(s,{span:8},{default:(0,o.k6)((()=>[(0,o.bF)(r,{modelValue:a.selectedOption2,"onUpdate:modelValue":n[1]||(n[1]=e=>a.selectedOption2=e),placeholder:"请选择索引",onChange:e.fetchOptions3},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.options2,(e=>((0,o.uX)(),(0,o.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,o.bF)(s,{span:8},{default:(0,o.k6)((()=>[(0,o.bF)(r,{modelValue:a.selectedOption3,"onUpdate:modelValue":n[2]||(n[2]=e=>a.selectedOption3=e),placeholder:"请选择索引",onChange:a.fetchData},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.options3,(e=>((0,o.uX)(),(0,o.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1}),a.records.length?((0,o.uX)(),(0,o.Wv)(m,{key:0,data:a.records,style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(c,{prop:"leafname",label:"Name"}),(0,o.bF)(c,{prop:"cid",label:"CID"}),(0,o.bF)(c,{label:"Action",width:"180"},{default:(0,o.k6)((({row:e})=>[(0,o.bF)(p,{onClick:n=>a.downloadRecord(e),type:"primary",size:"small",loading:e.downloading},{default:(0,o.k6)((()=>n[3]||(n[3]=[(0,o.eW)("Download")]))),_:2},1032,["onClick","loading"])])),_:1})])),_:1},8,["data"])):(0,o.Q3)("",!0)])}var j=t(144),D=t(1219),I=t(2933),q={setup(){const e=(0,j.KR)(""),n=(0,j.KR)(""),t=(0,j.KR)(""),a=(0,j.KR)([]),l=(0,j.KR)([]),d=(0,j.KR)([]),i=(0,j.KR)([]),r=async()=>{try{const n={index:{name:"",L1:"",L2:"",leafname:""}};console.log(n);const t=await V(n);a.value=t.data.index,a.value.length>0&&(e.value=a.value[0],s())}catch(n){console.error("Failed to fetch options1",n)}},s=async()=>{if(e.value)try{const t={index:{name:e.value,L1:"",L2:"",leafname:""}};console.log(t);const a=await V(t);l.value=a.data.index,l.value.length>0&&(n.value=l.value[0],u())}catch(t){console.error("Failed to fetch options2",t)}},u=async()=>{if(e.value&&n.value)try{const a={index:{name:e.value,L1:n.value,L2:"",leafname:""}};console.log(a);const o=await V(a);d.value=o.data.index,d.value.length>0&&(t.value=d.value[0],c())}catch(a){console.error("Failed to fetch options3",a)}},c=async()=>{if(e.value&&n.value&&t.value)try{const a={index:{name:e.value,L1:n.value,L2:t.value,leafname:""}};console.log(a);const o=await V(a);i.value=o.data.index}catch(a){console.error("Failed to fetch records",a)}else i.value=[]},p=async e=>{try{const{size:n,type:t}=await x(e.cid);if("directory"===t)return void D.nk.error("不支持下载目录");n>52428800&&await I.s.confirm(`文件较大（${(n/1024/1024).toFixed(1)}MB），确认下载吗？`,"下载确认",{type:"warning"});const a=(0,D.nk)({message:"下载准备中...",type:"info",duration:0,showClose:!0}),o=await E(e.cid,e.leafname||`file_${e.cid.slice(0,8)}`,(e=>{a.message=`下载进度: ${e}%`}));a.close(),o?D.nk.success("下载已开始"):D.nk.warning("已切换备用网关下载")}catch(n){"cancel"!==n&&D.nk.error(`下载失败: ${n.message}`)}};return(0,o.sV)((()=>{r()})),(0,o.wB)(e,(()=>{s()})),(0,o.wB)(n,(()=>{u()})),{selectedOption1:e,selectedOption2:n,selectedOption3:t,options1:a,options2:l,options3:d,records:i,fetchData:c,downloadRecord:p}}};const X=(0,s.A)(q,[["render",W],["__scopeId","data-v-13ff0c54"]]);var K=X;const T=[{path:"/endpoint",name:"Endpoint",component:O},{path:"/node",name:"Node",component:R},{path:"/query",name:"Query",component:K},{path:"/",redirect:"/endpoint"}],z=(0,i.aE)({history:(0,i.LA)(),routes:T});var M=z;const S=(0,a.Ef)(c);S.use(M),S.use(p.A),S.mount("#app")}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var l=n[a]={exports:{}};return e[a].call(l.exports,l,l.exports,t),l.exports}t.m=e,function(){var e=[];t.O=function(n,a,o,l){if(!a){var d=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],l=e[u][2];for(var i=!0,r=0;r<a.length;r++)(!1&l||d>=l)&&Object.keys(t.O).every((function(e){return t.O[e](a[r])}))?a.splice(r--,1):(i=!1,l<d&&(d=l));if(i){e.splice(u--,1);var s=o();void 0!==s&&(n=s)}}return n}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,o,l]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var o,l,d=a[0],i=a[1],r=a[2],s=0;if(d.some((function(n){return 0!==e[n]}))){for(o in i)t.o(i,o)&&(t.m[o]=i[o]);if(r)var u=r(t)}for(n&&n(a);s<d.length;s++)l=d[s],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(u)},a=self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[504],(function(){return t(1873)}));a=t.O(a)})();
//# sourceMappingURL=app.d15b119d.js.map